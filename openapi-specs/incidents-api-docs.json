{
  "openapi": "3.0.1",
  "info": {
    "title": "Incident Reporting API",
    "description": "API for viewing and managing incident reports",
    "contact": {
      "name": "HMPPS Digital Studio",
      "email": "feedback@digital.justice.gov.uk"
    },
    "license": {
      "name": "MIT"
    },
    "version": "2024-06-06.1848.edc03d2"
  },
  "servers": [
    {
      "url": "/",
      "description": "Current url"
    }
  ],
  "security": [
    {
      "bearer-jwt": [
        "read",
        "write"
      ]
    },
    {
      "hmpps-auth": []
    }
  ],
  "tags": [
    {
      "name": "Constants",
      "description": "Constants and enumerations used in incident reports"
    },
    {
      "name": "Incident reports",
      "description": "Create, retrieve, update and delete incident reports"
    },
    {
      "name": "Migrate/Upsert NOMIS Incident Report",
      "description": "Migrate or upsert NOMIS incident Report to IncidentReport Service."
    }
  ],
  "paths": {
    "/queue-admin/retry-dlq/{dlqName}": {
      "put": {
        "tags": [
          "hmpps-queue-resource"
        ],
        "operationId": "retryDlq",
        "parameters": [
          {
            "name": "dlqName",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/RetryDlqResult"
                }
              }
            }
          }
        }
      }
    },
    "/queue-admin/retry-all-dlqs": {
      "put": {
        "tags": [
          "hmpps-queue-resource"
        ],
        "operationId": "retryAllDlqs",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/RetryDlqResult"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/queue-admin/purge-queue/{queueName}": {
      "put": {
        "tags": [
          "hmpps-queue-resource"
        ],
        "operationId": "purgeQueue",
        "parameters": [
          {
            "name": "queueName",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/PurgeQueueResult"
                }
              }
            }
          }
        }
      }
    },
    "/sync/upsert": {
      "post": {
        "tags": [
          "Migrate/Upsert NOMIS Incident Report"
        ],
        "summary": "Migrate a location",
        "description": "Requires role MIGRATE_INCIDENT_REPORTS and write scope",
        "operationId": "upsertIncidentReport",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NomisSyncRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Migrated NOMIS Incident Report Id",
            "content": {
              "application/json": {
                "schema": {
                  "type": "string",
                  "format": "uuid"
                }
              }
            }
          },
          "200": {
            "description": "Updated NOMIS Incident Report Id",
            "content": {
              "application/json": {
                "schema": {
                  "type": "string",
                  "format": "uuid"
                }
              }
            }
          },
          "400": {
            "description": "Invalid Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized to access this endpoint",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Missing required role. Requires the MIGRATE_INCIDENT_REPORTS role with write scope.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Data not found, when id is provided",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/incident-reports": {
      "get": {
        "tags": [
          "Incident reports"
        ],
        "summary": "Returns pages of filtered incident reports",
        "description": "Requires role VIEW_INCIDENT_REPORTS",
        "operationId": "getReports",
        "parameters": [
          {
            "name": "prisonId",
            "in": "query",
            "description": "Filter by given prison ID",
            "required": false,
            "schema": {
              "maxLength": 10,
              "minLength": 2,
              "type": "string",
              "description": "Filter by given prison ID",
              "example": "MDI",
              "default": "null"
            },
            "example": "MDI"
          },
          {
            "name": "source",
            "in": "query",
            "description": "Filter by given information source",
            "required": false,
            "schema": {
              "type": "string",
              "enum": [
                "DPS",
                "NOMIS"
              ]
            },
            "example": "DPS"
          },
          {
            "name": "status",
            "in": "query",
            "description": "Filter by given statuses",
            "required": false,
            "schema": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": [
                  "DRAFT",
                  "AWAITING_ANALYSIS",
                  "IN_ANALYSIS",
                  "INFORMATION_REQUIRED",
                  "INFORMATION_AMENDED",
                  "CLOSED",
                  "POST_INCIDENT_UPDATE",
                  "INCIDENT_UPDATED",
                  "DUPLICATE"
                ]
              },
              "default": null
            },
            "example": "CLOSED,DUPLICATE"
          },
          {
            "name": "type",
            "in": "query",
            "description": "Filter by given incident type",
            "required": false,
            "schema": {
              "type": "string",
              "enum": [
                "ABSCONDER",
                "ASSAULT",
                "ATTEMPTED_ESCAPE_FROM_CUSTODY",
                "ATTEMPTED_ESCAPE_FROM_ESCORT",
                "BOMB_THREAT",
                "BREACH_OF_SECURITY",
                "DAMAGE",
                "DEATH_IN_CUSTODY",
                "DEATH_OTHER",
                "DISORDER",
                "DRONE_SIGHTING",
                "ESCAPE_FROM_CUSTODY",
                "ESCAPE_FROM_ESCORT",
                "FINDS",
                "FIRE",
                "FOOD_REFUSAL",
                "FULL_CLOSE_DOWN_SEARCH",
                "KEY_LOCK_INCIDENT",
                "MISCELLANEOUS",
                "RADIO_COMPROMISE",
                "RELEASED_IN_ERROR",
                "SELF_HARM",
                "TEMPORARY_RELEASE_FAILURE",
                "TOOL_LOSS",
                "OLD_ASSAULT",
                "OLD_ASSAULT1",
                "OLD_ASSAULT2",
                "OLD_ASSAULT3",
                "OLD_BARRICADE",
                "OLD_CONCERTED_INDISCIPLINE",
                "OLD_DISORDER",
                "OLD_DRONE_SIGHTING",
                "OLD_DRUGS",
                "OLD_FINDS",
                "OLD_FINDS1",
                "OLD_FINDS2",
                "OLD_FINDS3",
                "OLD_FINDS4",
                "OLD_FIREARM_ETC",
                "OLD_HOSTAGE",
                "OLD_KEY_LOCK_INCIDENT",
                "OLD_MOBILES",
                "OLD_ROOF_CLIMB",
                "OLD_TEMPORARY_RELEASE_FAILURE",
                "OLD_TEMPORARY_RELEASE_FAILURE1",
                "OLD_TEMPORARY_RELEASE_FAILURE2"
              ]
            },
            "example": "DAMAGE"
          },
          {
            "name": "incidentDateFrom",
            "in": "query",
            "description": "Filter for incidents occurring since this date (inclusive)",
            "required": false,
            "schema": {
              "type": "string",
              "description": "Filter for incidents occurring since this date (inclusive)",
              "format": "date",
              "example": "2024-01-01"
            },
            "example": "2024-01-01"
          },
          {
            "name": "incidentDateUntil",
            "in": "query",
            "description": "Filter for incidents occurring until this date (inclusive)",
            "required": false,
            "schema": {
              "type": "string",
              "description": "Filter for incidents occurring until this date (inclusive)",
              "format": "date",
              "example": "2024-05-31"
            },
            "example": "2024-05-31"
          },
          {
            "name": "reportedDateFrom",
            "in": "query",
            "description": "Filter for incidents reported since this date (inclusive)",
            "required": false,
            "schema": {
              "type": "string",
              "description": "Filter for incidents reported since this date (inclusive)",
              "format": "date",
              "example": "2024-01-01"
            },
            "example": "2024-01-01"
          },
          {
            "name": "reportedDateUntil",
            "in": "query",
            "description": "Filter for incidents reported until this date (inclusive)",
            "required": false,
            "schema": {
              "type": "string",
              "description": "Filter for incidents reported until this date (inclusive)",
              "format": "date",
              "example": "2024-05-31"
            },
            "example": "2024-05-31"
          },
          {
            "name": "page",
            "in": "query",
            "description": "Zero-based page index (0..N)",
            "required": false,
            "schema": {
              "minimum": 0,
              "type": "integer",
              "default": 0
            }
          },
          {
            "name": "size",
            "in": "query",
            "description": "The size of the page to be returned",
            "required": false,
            "schema": {
              "minimum": 1,
              "type": "integer",
              "default": 20
            }
          },
          {
            "name": "sort",
            "in": "query",
            "description": "Sorting criteria in the format: property,(asc|desc). Default sort order is ascending. Multiple sort criteria are supported.",
            "required": false,
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": [
                "incidentDateAndTime,DESC"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Returns a page of incident reports",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SimplePageReport"
                }
              }
            }
          },
          "400": {
            "description": "When input parameters are not valid",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized to access this endpoint",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Missing required role. Requires the VIEW_INCIDENT_REPORTS role",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Incident reports"
        ],
        "summary": "Creates an incident report",
        "description": "Requires role MAINTAIN_INCIDENT_REPORTS and write scope",
        "operationId": "createReport",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateReportRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Returns created incident report",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Report"
                }
              }
            }
          },
          "400": {
            "description": "Invalid Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized to access this endpoint",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Missing required role. Requires the MAINTAIN_INCIDENT_REPORTS role with write scope.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Data not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "409": {
            "description": "Incident report already exists",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/subject-access-request": {
      "get": {
        "tags": [
          "Subject Access Request"
        ],
        "summary": "Provides content for a prisoner to satisfy the needs of a subject access request on their behalf",
        "description": "Requires role SAR_DATA_ACCESS or additional role as specified by hmpps.sar.additionalAccessRole configuration.",
        "operationId": "getSarContentByReference",
        "parameters": [
          {
            "name": "prn",
            "in": "query",
            "description": "NOMIS Prison Reference Number",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "crn",
            "in": "query",
            "description": "nDelius Case Reference Number",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "fromDate",
            "in": "query",
            "description": "Optional parameter denoting minimum date of event occurrence which should be returned in the response",
            "required": false,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "toDate",
            "in": "query",
            "description": "Optional parameter denoting maximum date of event occurrence which should be returned in the response",
            "required": false,
            "schema": {
              "type": "string",
              "format": "date"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Request successfully processed - no content found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden, requires an appropriate role",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "200": {
            "description": "Request successfully processed - content found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HmppsSubjectAccessRequestContent"
                }
              }
            }
          },
          "209": {
            "description": "Subject Identifier is not recognised by this service",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          },
          "401": {
            "description": "The client does not have authorisation to make this request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Unexpected error occurred",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/queue-admin/get-dlq-messages/{dlqName}": {
      "get": {
        "tags": [
          "hmpps-queue-resource"
        ],
        "operationId": "getDlqMessages",
        "parameters": [
          {
            "name": "dlqName",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "maxMessages",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "default": 100
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/GetDlqResult"
                }
              }
            }
          }
        }
      }
    },
    "/incident-reports/{id}": {
      "get": {
        "tags": [
          "Incident reports"
        ],
        "summary": "Returns the incident report information for this ID",
        "description": "Requires role VIEW_INCIDENT_REPORTS",
        "operationId": "getReport",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "The incident report id",
            "required": true,
            "schema": {
              "type": "string",
              "description": "The incident report id",
              "example": "11111111-2222-3333-4444-555555555555"
            },
            "example": "11111111-2222-3333-4444-555555555555"
          }
        ],
        "responses": {
          "200": {
            "description": "Returns an incident report",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Report"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized to access this endpoint",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Missing required role. Requires the VIEW_INCIDENT_REPORTS role",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Data not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Incident reports"
        ],
        "summary": "Deletes an incident report",
        "description": "Requires role MAINTAIN_INCIDENT_REPORTS and write scope",
        "operationId": "deleteReport",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "The incident report id",
            "required": true,
            "schema": {
              "type": "string",
              "description": "The incident report id",
              "example": "11111111-2222-3333-4444-555555555555"
            },
            "example": "11111111-2222-3333-4444-555555555555"
          },
          {
            "name": "deleteOrphanedEvents",
            "in": "query",
            "description": "Whether orphaned events should also be deleted",
            "required": false,
            "schema": {
              "type": "string",
              "description": "Whether orphaned events should also be deleted",
              "example": false,
              "default": "true"
            },
            "example": false
          }
        ],
        "responses": {
          "200": {
            "description": "Returns deleted incident report",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Report"
                }
              }
            }
          },
          "400": {
            "description": "Invalid Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized to access this endpoint",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Missing required role. Requires the MAINTAIN_INCIDENT_REPORTS role with write scope.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Data not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/incident-reports/incident-number/{incidentNumber}": {
      "get": {
        "tags": [
          "Incident reports"
        ],
        "summary": "Returns the incident report information for this incident number",
        "description": "Requires role VIEW_INCIDENT_REPORTS",
        "operationId": "getReportByNumber",
        "parameters": [
          {
            "name": "incidentNumber",
            "in": "path",
            "description": "The incident report number",
            "required": true,
            "schema": {
              "type": "string",
              "description": "The incident report number",
              "example": 2342341242
            },
            "example": 2342341242
          }
        ],
        "responses": {
          "200": {
            "description": "Returns an incident report",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Report"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized to access this endpoint",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Missing required role. Requires the VIEW_INCIDENT_REPORTS role",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Data not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/constants/types": {
      "get": {
        "tags": [
          "Constants"
        ],
        "summary": "List codes and descriptions of incident types",
        "operationId": "types",
        "responses": {
          "200": {
            "description": "Returns codes and descriptions",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/DeactivatableConstantDescription"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/constants/statuses": {
      "get": {
        "tags": [
          "Constants"
        ],
        "summary": "List codes and descriptions of incident statuses",
        "operationId": "statuses",
        "responses": {
          "200": {
            "description": "Returns codes and descriptions",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ConstantDescription"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/constants/staff-roles": {
      "get": {
        "tags": [
          "Constants"
        ],
        "summary": "List codes and descriptions of roles of staff involvement in an incident",
        "operationId": "staffRoles",
        "responses": {
          "200": {
            "description": "Returns codes and descriptions",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ConstantDescription"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/constants/prisoner-roles": {
      "get": {
        "tags": [
          "Constants"
        ],
        "summary": "List codes and descriptions of roles of a prisoner’s involvement in an incident",
        "operationId": "prisonerRoles",
        "responses": {
          "200": {
            "description": "Returns codes and descriptions",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ConstantDescription"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/constants/prisoner-outcomes": {
      "get": {
        "tags": [
          "Constants"
        ],
        "summary": "List codes and descriptions of outcomes from a prisoner’s involvement in an incident",
        "operationId": "prisonerOutcomes",
        "responses": {
          "200": {
            "description": "Returns codes and descriptions",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ConstantDescription"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "RetryDlqResult": {
        "required": [
          "messagesFoundCount"
        ],
        "type": "object",
        "properties": {
          "messagesFoundCount": {
            "type": "integer",
            "format": "int32"
          }
        }
      },
      "PurgeQueueResult": {
        "required": [
          "messagesFoundCount"
        ],
        "type": "object",
        "properties": {
          "messagesFoundCount": {
            "type": "integer",
            "format": "int32"
          }
        }
      },
      "ErrorResponse": {
        "required": [
          "developerMessage",
          "status",
          "userMessage"
        ],
        "type": "object",
        "properties": {
          "status": {
            "type": "integer",
            "description": "HTTP status code",
            "format": "int32",
            "example": 500
          },
          "userMessage": {
            "type": "string",
            "description": "User message for the error",
            "example": "No incident report found for ID `55544222`"
          },
          "developerMessage": {
            "type": "string",
            "description": "More detailed error message",
            "example": "[Details, sometimes a stack trace]"
          },
          "errorCode": {
            "type": "integer",
            "description": "When present, uniquely identifies the type of error making it easier for clients to discriminate without relying on error description or HTTP status code; see ` uk.gov.justice.digital.hmpps.incidentreporting.resource.ErrorCode` enumeration in hmpps-incident-reporting-api",
            "format": "int32",
            "example": 101
          },
          "moreInfo": {
            "type": "string",
            "description": "More information about the error",
            "example": "[Rarely used, error-specific]"
          }
        },
        "description": "Error response"
      },
      "NomisCode": {
        "required": [
          "code",
          "description"
        ],
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "description": "Code"
          },
          "description": {
            "type": "string",
            "description": "Description"
          }
        },
        "description": "The outcome of the incident"
      },
      "NomisHistory": {
        "required": [
          "createDateTime",
          "createdBy",
          "incidentChangeDate",
          "incidentChangeStaff",
          "questionnaireId",
          "questions",
          "type"
        ],
        "type": "object",
        "properties": {
          "questionnaireId": {
            "type": "integer",
            "description": "The history questionnaire id for the incident",
            "format": "int64"
          },
          "type": {
            "type": "string",
            "description": "The questionnaire type"
          },
          "description": {
            "type": "string",
            "description": "The questionnaire description"
          },
          "questions": {
            "type": "array",
            "description": "Questions asked for the questionnaire",
            "items": {
              "$ref": "#/components/schemas/NomisHistoryQuestion"
            }
          },
          "incidentChangeDate": {
            "type": "string",
            "description": "When the questionnaire was changed",
            "format": "date"
          },
          "incidentChangeStaff": {
            "$ref": "#/components/schemas/NomisStaff"
          },
          "createDateTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "The date and time the historical incident questionnaire was created",
            "example": "2021-07-05T10:35:17"
          },
          "createdBy": {
            "type": "string",
            "description": "The username of the person who created the historical incident questionnaire"
          }
        },
        "description": "Historical questionnaire details for the incident"
      },
      "NomisHistoryQuestion": {
        "required": [
          "answers",
          "question",
          "questionId",
          "sequence"
        ],
        "type": "object",
        "properties": {
          "questionId": {
            "type": "integer",
            "description": "The sequence number of the response question for this incident",
            "format": "int64"
          },
          "sequence": {
            "type": "integer",
            "description": "The sequence number of the question for this incident",
            "format": "int32"
          },
          "question": {
            "type": "string",
            "description": "The Question being asked"
          },
          "answers": {
            "type": "array",
            "description": "Historical list of Responses to this question",
            "items": {
              "$ref": "#/components/schemas/NomisHistoryResponse"
            }
          }
        },
        "description": "Questions asked for the questionnaire"
      },
      "NomisHistoryResponse": {
        "required": [
          "recordingStaff",
          "responseSequence"
        ],
        "type": "object",
        "properties": {
          "questionResponseId": {
            "type": "integer",
            "description": "The id of the questionnaire question answer",
            "format": "int64"
          },
          "responseSequence": {
            "type": "integer",
            "description": "The sequence number of the response for this incident",
            "format": "int32"
          },
          "answer": {
            "type": "string",
            "description": "The answer text"
          },
          "comment": {
            "type": "string",
            "description": "Comment added to the response by recording staff"
          },
          "recordingStaff": {
            "$ref": "#/components/schemas/NomisStaff"
          },
          "responseDate": {
            "type": "string",
            "description": "Response date added to the response by recording staff",
            "format": "date"
          }
        },
        "description": "Historical list of Responses to this question"
      },
      "NomisOffender": {
        "required": [
          "lastName",
          "offenderNo"
        ],
        "type": "object",
        "properties": {
          "offenderNo": {
            "type": "string",
            "description": "NOMIS id"
          },
          "firstName": {
            "type": "string",
            "description": "First name of staff member"
          },
          "lastName": {
            "type": "string",
            "description": "Last name of staff member"
          }
        },
        "description": "Offender involved in the incident"
      },
      "NomisOffenderParty": {
        "required": [
          "createDateTime",
          "createdBy",
          "offender",
          "role"
        ],
        "type": "object",
        "properties": {
          "offender": {
            "$ref": "#/components/schemas/NomisOffender"
          },
          "role": {
            "$ref": "#/components/schemas/NomisCode"
          },
          "outcome": {
            "$ref": "#/components/schemas/NomisCode"
          },
          "comment": {
            "type": "string",
            "description": "General information about the incident"
          },
          "createDateTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "The date and time the offender party was created",
            "example": "2021-07-05T10:35:17"
          },
          "createdBy": {
            "type": "string",
            "description": "The username of the person who created the offender party"
          },
          "lastModifiedDateTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "The date and time the offender party was last updated",
            "example": "2021-07-05T10:35:17"
          },
          "lastModifiedBy": {
            "type": "string",
            "description": "The username of the person who last updated the offender party"
          }
        },
        "description": "Offenders involved in the incident"
      },
      "NomisQuestion": {
        "required": [
          "answers",
          "createDateTime",
          "createdBy",
          "question",
          "questionId",
          "sequence"
        ],
        "type": "object",
        "properties": {
          "questionId": {
            "type": "integer",
            "description": "The questionnaire question id",
            "format": "int64"
          },
          "sequence": {
            "type": "integer",
            "description": "The sequence number of the question for this incident",
            "format": "int32"
          },
          "createDateTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "The date and time the question was created",
            "example": "2021-07-05T10:35:17"
          },
          "createdBy": {
            "type": "string",
            "description": "The username of the person who created the question"
          },
          "question": {
            "type": "string",
            "description": "The Question being asked"
          },
          "answers": {
            "type": "array",
            "description": "List of Responses to this question",
            "items": {
              "$ref": "#/components/schemas/NomisResponse"
            }
          }
        },
        "description": "Questions asked for the incident"
      },
      "NomisReport": {
        "required": [
          "createDateTime",
          "createdBy",
          "history",
          "incidentDateTime",
          "incidentId",
          "lockedResponse",
          "offenderParties",
          "prison",
          "questionnaireId",
          "questions",
          "reportedDateTime",
          "reportingStaff",
          "requirements",
          "staffParties",
          "status",
          "type"
        ],
        "type": "object",
        "properties": {
          "incidentId": {
            "type": "integer",
            "description": "The Incident id",
            "format": "int64"
          },
          "questionnaireId": {
            "type": "integer",
            "description": "The id of the questionnaire associated with this incident",
            "format": "int64"
          },
          "title": {
            "type": "string",
            "description": "A summary of the incident"
          },
          "description": {
            "type": "string",
            "description": "The incident details"
          },
          "prison": {
            "$ref": "#/components/schemas/NomisCode"
          },
          "status": {
            "$ref": "#/components/schemas/NomisStatus"
          },
          "type": {
            "type": "string",
            "description": "The incident questionnaire type"
          },
          "lockedResponse": {
            "type": "boolean",
            "description": "If the response is locked ie if the response is completed"
          },
          "incidentDateTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "The date and time of the incident",
            "example": "2021-07-05T10:35:17"
          },
          "reportingStaff": {
            "$ref": "#/components/schemas/NomisStaff"
          },
          "reportedDateTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "The date and time the incident was reported",
            "example": "2021-07-05T10:35:17"
          },
          "createDateTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "The date and time the incident was created",
            "example": "2021-07-05T10:35:17"
          },
          "createdBy": {
            "type": "string",
            "description": "The username of the person who created the incident"
          },
          "lastModifiedDateTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "The date and time the incident was last updated",
            "example": "2021-07-05T10:35:17"
          },
          "lastModifiedBy": {
            "type": "string",
            "description": "The username of the person who last updated the incident"
          },
          "followUpDate": {
            "type": "string",
            "description": "The follow up date for the incident",
            "format": "date"
          },
          "staffParties": {
            "type": "array",
            "description": "Staff involved in the incident",
            "items": {
              "$ref": "#/components/schemas/NomisStaffParty"
            }
          },
          "offenderParties": {
            "type": "array",
            "description": "Offenders involved in the incident",
            "items": {
              "$ref": "#/components/schemas/NomisOffenderParty"
            }
          },
          "requirements": {
            "type": "array",
            "description": "Requirements for completing the incident report",
            "items": {
              "$ref": "#/components/schemas/NomisRequirement"
            }
          },
          "questions": {
            "type": "array",
            "description": "Questions asked for the incident",
            "items": {
              "$ref": "#/components/schemas/NomisQuestion"
            }
          },
          "history": {
            "type": "array",
            "description": "Historical questionnaire details for the incident",
            "items": {
              "$ref": "#/components/schemas/NomisHistory"
            }
          }
        },
        "description": "NOMIS Incident Report Details"
      },
      "NomisRequirement": {
        "required": [
          "createDateTime",
          "createdBy",
          "date",
          "prisonId",
          "staff"
        ],
        "type": "object",
        "properties": {
          "comment": {
            "type": "string",
            "description": "The update required to the incident report"
          },
          "date": {
            "type": "string",
            "description": "Date the requirement was recorded",
            "format": "date"
          },
          "staff": {
            "$ref": "#/components/schemas/NomisStaff"
          },
          "prisonId": {
            "type": "string",
            "description": "The reporting location of the staff"
          },
          "createDateTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "The date and time the requirement was created",
            "example": "2021-07-05T10:35:17"
          },
          "createdBy": {
            "type": "string",
            "description": "The username of the person who created the requirement"
          },
          "lastModifiedDateTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "The date and time the requirement was last updated",
            "example": "2021-07-05T10:35:17"
          },
          "lastModifiedBy": {
            "type": "string",
            "description": "The username of the person who last updated the requirement"
          }
        },
        "description": "Requirements for completing the incident report"
      },
      "NomisResponse": {
        "required": [
          "createDateTime",
          "createdBy",
          "recordingStaff",
          "sequence"
        ],
        "type": "object",
        "properties": {
          "questionResponseId": {
            "type": "integer",
            "description": "The id of the questionnaire question answer",
            "format": "int64"
          },
          "sequence": {
            "type": "integer",
            "description": "The sequence number of the response for this incident",
            "format": "int32"
          },
          "answer": {
            "type": "string",
            "description": "The answer text"
          },
          "comment": {
            "type": "string",
            "description": "Comment added to the response by recording staff"
          },
          "responseDate": {
            "type": "string",
            "description": "Response date added to the response by recording staff",
            "format": "date"
          },
          "createDateTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "The date and time the response was created",
            "example": "2021-07-05T10:35:17"
          },
          "createdBy": {
            "type": "string",
            "description": "The username of the person who created the response"
          },
          "lastModifiedDateTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "The date and time the response was last updated",
            "example": "2021-07-05T10:35:17"
          },
          "lastModifiedBy": {
            "type": "string",
            "description": "The username of the person who last updated the response"
          },
          "recordingStaff": {
            "$ref": "#/components/schemas/NomisStaff"
          }
        },
        "description": "List of Responses to this question"
      },
      "NomisStaff": {
        "required": [
          "firstName",
          "lastName",
          "staffId",
          "username"
        ],
        "type": "object",
        "properties": {
          "username": {
            "type": "string",
            "description": "Username of first account related to staff"
          },
          "staffId": {
            "type": "integer",
            "description": "NOMIS staff id",
            "format": "int64"
          },
          "firstName": {
            "type": "string",
            "description": "First name of staff member"
          },
          "lastName": {
            "type": "string",
            "description": "Last name of staff member"
          }
        },
        "description": "Who changed the questionnaire"
      },
      "NomisStaffParty": {
        "required": [
          "createDateTime",
          "createdBy",
          "role",
          "staff"
        ],
        "type": "object",
        "properties": {
          "staff": {
            "$ref": "#/components/schemas/NomisStaff"
          },
          "role": {
            "$ref": "#/components/schemas/NomisCode"
          },
          "comment": {
            "type": "string",
            "description": "General information about the incident"
          },
          "createDateTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "The date and time the staff party was created",
            "example": "2021-07-05T10:35:17"
          },
          "createdBy": {
            "type": "string",
            "description": "The username of the person who created the staff party"
          },
          "lastModifiedDateTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "The date and time the staff party was last updated",
            "example": "2021-07-05T10:35:17"
          },
          "lastModifiedBy": {
            "type": "string",
            "description": "The username of the person who last updated the staff party"
          }
        },
        "description": "Staff involved in the incident"
      },
      "NomisStatus": {
        "required": [
          "code",
          "description"
        ],
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "description": "Status Code"
          },
          "description": {
            "type": "string",
            "description": "Status Description"
          }
        },
        "description": "Status details"
      },
      "NomisSyncRequest": {
        "required": [
          "incidentReport"
        ],
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "For updates, this value is the UUID of the existing incident. For new incidents, this value is null.",
            "format": "uuid",
            "example": "123e4567-e89b-12d3-a456-426614174000"
          },
          "initialMigration": {
            "type": "boolean",
            "description": "For initial migration this is true",
            "default": false
          },
          "incidentReport": {
            "$ref": "#/components/schemas/NomisReport"
          }
        },
        "description": "Incident report created/updated in NOMIS"
      },
      "CreateReportRequest": {
        "required": [
          "description",
          "incidentDateAndTime",
          "prisonId",
          "reportedBy",
          "reportedDate",
          "title",
          "type"
        ],
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Incident report type",
            "enum": [
              "ABSCONDER",
              "ASSAULT",
              "ATTEMPTED_ESCAPE_FROM_CUSTODY",
              "ATTEMPTED_ESCAPE_FROM_ESCORT",
              "BOMB_THREAT",
              "BREACH_OF_SECURITY",
              "DAMAGE",
              "DEATH_IN_CUSTODY",
              "DEATH_OTHER",
              "DISORDER",
              "DRONE_SIGHTING",
              "ESCAPE_FROM_CUSTODY",
              "ESCAPE_FROM_ESCORT",
              "FINDS",
              "FIRE",
              "FOOD_REFUSAL",
              "FULL_CLOSE_DOWN_SEARCH",
              "KEY_LOCK_INCIDENT",
              "MISCELLANEOUS",
              "RADIO_COMPROMISE",
              "RELEASED_IN_ERROR",
              "SELF_HARM",
              "TEMPORARY_RELEASE_FAILURE",
              "TOOL_LOSS",
              "OLD_ASSAULT",
              "OLD_ASSAULT1",
              "OLD_ASSAULT2",
              "OLD_ASSAULT3",
              "OLD_BARRICADE",
              "OLD_CONCERTED_INDISCIPLINE",
              "OLD_DISORDER",
              "OLD_DRONE_SIGHTING",
              "OLD_DRUGS",
              "OLD_FINDS",
              "OLD_FINDS1",
              "OLD_FINDS2",
              "OLD_FINDS3",
              "OLD_FINDS4",
              "OLD_FIREARM_ETC",
              "OLD_HOSTAGE",
              "OLD_KEY_LOCK_INCIDENT",
              "OLD_MOBILES",
              "OLD_ROOF_CLIMB",
              "OLD_TEMPORARY_RELEASE_FAILURE",
              "OLD_TEMPORARY_RELEASE_FAILURE1",
              "OLD_TEMPORARY_RELEASE_FAILURE2"
            ]
          },
          "incidentDateAndTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "When the incident took place",
            "example": "2021-07-05T10:35:17"
          },
          "prisonId": {
            "type": "string",
            "description": "The NOMIS id of the prison where incident took place",
            "example": "MDI"
          },
          "title": {
            "type": "string",
            "description": "Brief title describing the incident"
          },
          "description": {
            "type": "string",
            "description": "Longer summary of the incident"
          },
          "createNewEvent": {
            "type": "boolean",
            "description": "Whether to link to a new event",
            "default": false
          },
          "linkedEventId": {
            "type": "string",
            "description": "Which existing event to link to",
            "default": "null"
          },
          "reportedBy": {
            "type": "string",
            "description": "Username of person who created the incident report"
          },
          "reportedDate": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "When the incident report was created",
            "example": "2021-07-05T10:35:17"
          }
        },
        "description": "Payload to create a new incident report"
      },
      "CorrectionRequest": {
        "required": [
          "correctionRequestedAt",
          "correctionRequestedBy",
          "descriptionOfChange",
          "reason"
        ],
        "type": "object",
        "properties": {
          "reason": {
            "type": "string",
            "description": "Why the correction is needed",
            "enum": [
              "MISTAKE",
              "INCORRECT_INFORMATION",
              "MISSING_INFORMATION",
              "OTHER",
              "NOT_SPECIFIED"
            ]
          },
          "descriptionOfChange": {
            "type": "string",
            "description": "The changes being requested"
          },
          "correctionRequestedBy": {
            "type": "string",
            "description": "Member of staff requesting changed"
          },
          "correctionRequestedAt": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "When the changes were requested",
            "example": "2021-07-05T10:35:17"
          }
        },
        "description": "Request to make a correction to incident report"
      },
      "Event": {
        "required": [
          "createdAt",
          "description",
          "eventDateAndTime",
          "eventId",
          "modifiedAt",
          "modifiedBy",
          "prisonId",
          "title"
        ],
        "type": "object",
        "properties": {
          "eventId": {
            "type": "string",
            "description": "The human-readable identifier of this report"
          },
          "eventDateAndTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "When the incident took place",
            "example": "2021-07-05T10:35:17"
          },
          "prisonId": {
            "type": "string",
            "description": "The NOMIS id of the prison where incident took place",
            "example": "MDI"
          },
          "title": {
            "type": "string",
            "description": "Brief title describing the event"
          },
          "description": {
            "type": "string",
            "description": "Longer summary of the event"
          },
          "createdAt": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "When the report was first created",
            "example": "2021-07-05T10:35:17"
          },
          "modifiedAt": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "When the report was last changed",
            "example": "2021-07-05T10:35:17"
          },
          "modifiedBy": {
            "type": "string",
            "description": "Username of the person who last changed this report"
          }
        },
        "description": "Event linking multiple incident reports"
      },
      "Evidence": {
        "required": [
          "description",
          "type"
        ],
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Type of evidence"
          },
          "description": {
            "type": "string",
            "description": "Description of evidence"
          }
        },
        "description": "Evidence supporting an incident report"
      },
      "HistoricalQuestion": {
        "required": [
          "code",
          "question",
          "responses"
        ],
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "description": "The question code"
          },
          "question": {
            "type": "string",
            "description": "The question"
          },
          "responses": {
            "type": "array",
            "description": "The responses to this question",
            "items": {
              "$ref": "#/components/schemas/HistoricalResponse"
            }
          },
          "additionalInformation": {
            "type": "string",
            "description": "Optional additional information",
            "default": "null"
          }
        },
        "description": "Previous question with responses making up a previous version of an incident report"
      },
      "HistoricalResponse": {
        "required": [
          "recordedAt",
          "recordedBy",
          "response"
        ],
        "type": "object",
        "properties": {
          "response": {
            "type": "string",
            "description": "The response"
          },
          "recordedBy": {
            "type": "string",
            "description": "Username of person who responded to the question"
          },
          "recordedAt": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "When the response was made",
            "example": "2021-07-05T10:35:17"
          },
          "additionalInformation": {
            "type": "string",
            "description": "Optional additional information",
            "default": "null"
          }
        },
        "description": "Previous response to a question making up a previous version of an incident report"
      },
      "History": {
        "required": [
          "changedAt",
          "changedBy",
          "questions",
          "type"
        ],
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Previous incident report type",
            "enum": [
              "ABSCONDER",
              "ASSAULT",
              "ATTEMPTED_ESCAPE_FROM_CUSTODY",
              "ATTEMPTED_ESCAPE_FROM_ESCORT",
              "BOMB_THREAT",
              "BREACH_OF_SECURITY",
              "DAMAGE",
              "DEATH_IN_CUSTODY",
              "DEATH_OTHER",
              "DISORDER",
              "DRONE_SIGHTING",
              "ESCAPE_FROM_CUSTODY",
              "ESCAPE_FROM_ESCORT",
              "FINDS",
              "FIRE",
              "FOOD_REFUSAL",
              "FULL_CLOSE_DOWN_SEARCH",
              "KEY_LOCK_INCIDENT",
              "MISCELLANEOUS",
              "RADIO_COMPROMISE",
              "RELEASED_IN_ERROR",
              "SELF_HARM",
              "TEMPORARY_RELEASE_FAILURE",
              "TOOL_LOSS",
              "OLD_ASSAULT",
              "OLD_ASSAULT1",
              "OLD_ASSAULT2",
              "OLD_ASSAULT3",
              "OLD_BARRICADE",
              "OLD_CONCERTED_INDISCIPLINE",
              "OLD_DISORDER",
              "OLD_DRONE_SIGHTING",
              "OLD_DRUGS",
              "OLD_FINDS",
              "OLD_FINDS1",
              "OLD_FINDS2",
              "OLD_FINDS3",
              "OLD_FINDS4",
              "OLD_FIREARM_ETC",
              "OLD_HOSTAGE",
              "OLD_KEY_LOCK_INCIDENT",
              "OLD_MOBILES",
              "OLD_ROOF_CLIMB",
              "OLD_TEMPORARY_RELEASE_FAILURE",
              "OLD_TEMPORARY_RELEASE_FAILURE1",
              "OLD_TEMPORARY_RELEASE_FAILURE2"
            ]
          },
          "changedAt": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "When the report type was changed",
            "example": "2021-07-05T10:35:17"
          },
          "changedBy": {
            "type": "string",
            "description": "The member of staff who changed the report type"
          },
          "questions": {
            "type": "array",
            "description": "Previous set of question-response pairs",
            "items": {
              "$ref": "#/components/schemas/HistoricalQuestion"
            }
          }
        },
        "description": "Prior version of an incident report"
      },
      "Location": {
        "required": [
          "description",
          "locationId",
          "type"
        ],
        "type": "object",
        "properties": {
          "locationId": {
            "type": "string",
            "description": "NOMIS id of location"
          },
          "type": {
            "type": "string",
            "description": "Type of location"
          },
          "description": {
            "type": "string",
            "description": "Description of location"
          }
        },
        "description": "Where an incident took place"
      },
      "PrisonerInvolvement": {
        "required": [
          "prisonerNumber",
          "prisonerRole"
        ],
        "type": "object",
        "properties": {
          "prisonerNumber": {
            "type": "string",
            "description": "Prisoner’s NOMIS number"
          },
          "prisonerRole": {
            "type": "string",
            "description": "Their role",
            "enum": [
              "ABSCONDER",
              "ACTIVE_INVOLVEMENT",
              "ASSAILANT",
              "ASSISTED_STAFF",
              "DECEASED",
              "ESCAPE",
              "FIGHTER",
              "HOSTAGE",
              "IMPEDED_STAFF",
              "IN_POSSESSION",
              "INTENDED_RECIPIENT",
              "LICENSE_FAILURE",
              "PERPETRATOR",
              "PRESENT_AT_SCENE",
              "SUSPECTED_ASSAILANT",
              "SUSPECTED_INVOLVED",
              "TEMPORARY_RELEASE_FAILURE",
              "VICTIM"
            ]
          },
          "outcome": {
            "type": "string",
            "description": "Optional outcome of prisoner’s involvement",
            "default": "null",
            "enum": [
              "ACCT",
              "CHARGED_BY_POLICE",
              "CONVICTED",
              "CORONER_INFORMED",
              "DEATH",
              "FURTHER_CHARGES",
              "LOCAL_INVESTIGATION",
              "NEXT_OF_KIN_INFORMED",
              "PLACED_ON_REPORT",
              "POLICE_INVESTIGATION",
              "REMAND",
              "SEEN_DUTY_GOV",
              "SEEN_HEALTHCARE",
              "SEEN_IMB",
              "SEEN_OUTSIDE_HOSP",
              "TRANSFER",
              "TRIAL"
            ]
          },
          "comment": {
            "type": "string",
            "description": "Optional comment on prisoner’s involvement",
            "default": "null"
          }
        },
        "description": "Prisoner involved in an incident"
      },
      "Question": {
        "required": [
          "code",
          "question",
          "responses"
        ],
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "description": "The question code"
          },
          "question": {
            "type": "string",
            "description": "The question"
          },
          "responses": {
            "type": "array",
            "description": "The responses to this question",
            "items": {
              "$ref": "#/components/schemas/Response"
            }
          },
          "additionalInformation": {
            "type": "string",
            "description": "Optional additional information",
            "default": "null"
          }
        },
        "description": "Question with responses making up an incident report"
      },
      "Report": {
        "required": [
          "correctionRequests",
          "createdAt",
          "createdInNomis",
          "description",
          "event",
          "evidence",
          "history",
          "historyOfStatuses",
          "id",
          "incidentDateAndTime",
          "incidentNumber",
          "locations",
          "modifiedAt",
          "modifiedBy",
          "prisonId",
          "prisonersInvolved",
          "questions",
          "reportedAt",
          "reportedBy",
          "staffInvolved",
          "title",
          "type"
        ],
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "The internal ID of this report",
            "format": "uuid"
          },
          "incidentNumber": {
            "type": "string",
            "description": "The human-readable identifier of this report"
          },
          "type": {
            "type": "string",
            "description": "Incident report type",
            "enum": [
              "ABSCONDER",
              "ASSAULT",
              "ATTEMPTED_ESCAPE_FROM_CUSTODY",
              "ATTEMPTED_ESCAPE_FROM_ESCORT",
              "BOMB_THREAT",
              "BREACH_OF_SECURITY",
              "DAMAGE",
              "DEATH_IN_CUSTODY",
              "DEATH_OTHER",
              "DISORDER",
              "DRONE_SIGHTING",
              "ESCAPE_FROM_CUSTODY",
              "ESCAPE_FROM_ESCORT",
              "FINDS",
              "FIRE",
              "FOOD_REFUSAL",
              "FULL_CLOSE_DOWN_SEARCH",
              "KEY_LOCK_INCIDENT",
              "MISCELLANEOUS",
              "RADIO_COMPROMISE",
              "RELEASED_IN_ERROR",
              "SELF_HARM",
              "TEMPORARY_RELEASE_FAILURE",
              "TOOL_LOSS",
              "OLD_ASSAULT",
              "OLD_ASSAULT1",
              "OLD_ASSAULT2",
              "OLD_ASSAULT3",
              "OLD_BARRICADE",
              "OLD_CONCERTED_INDISCIPLINE",
              "OLD_DISORDER",
              "OLD_DRONE_SIGHTING",
              "OLD_DRUGS",
              "OLD_FINDS",
              "OLD_FINDS1",
              "OLD_FINDS2",
              "OLD_FINDS3",
              "OLD_FINDS4",
              "OLD_FIREARM_ETC",
              "OLD_HOSTAGE",
              "OLD_KEY_LOCK_INCIDENT",
              "OLD_MOBILES",
              "OLD_ROOF_CLIMB",
              "OLD_TEMPORARY_RELEASE_FAILURE",
              "OLD_TEMPORARY_RELEASE_FAILURE1",
              "OLD_TEMPORARY_RELEASE_FAILURE2"
            ]
          },
          "incidentDateAndTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "When the incident took place",
            "example": "2021-07-05T10:35:17"
          },
          "prisonId": {
            "type": "string",
            "description": "The NOMIS id of the prison where incident took place",
            "example": "MDI"
          },
          "title": {
            "type": "string",
            "description": "Brief title describing the incident"
          },
          "description": {
            "type": "string",
            "description": "Longer summary of the incident"
          },
          "event": {
            "$ref": "#/components/schemas/Event"
          },
          "reportedBy": {
            "type": "string",
            "description": "Username of person who created the incident report"
          },
          "reportedAt": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "When the incident report was created",
            "example": "2021-07-05T10:35:17"
          },
          "status": {
            "type": "string",
            "description": "The current status of this report",
            "default": "DRAFT",
            "enum": [
              "DRAFT",
              "AWAITING_ANALYSIS",
              "IN_ANALYSIS",
              "INFORMATION_REQUIRED",
              "INFORMATION_AMENDED",
              "CLOSED",
              "POST_INCIDENT_UPDATE",
              "INCIDENT_UPDATED",
              "DUPLICATE"
            ]
          },
          "assignedTo": {
            "type": "string",
            "description": "Optional user who this report is currently assigned to",
            "default": "null"
          },
          "questions": {
            "type": "array",
            "description": "The question-response pairs that make up this report",
            "items": {
              "$ref": "#/components/schemas/Question"
            }
          },
          "history": {
            "type": "array",
            "description": "Prior versions of this report, created when the report type changes",
            "items": {
              "$ref": "#/components/schemas/History"
            }
          },
          "historyOfStatuses": {
            "type": "array",
            "description": "Previous statuses the incident report transitioned to",
            "items": {
              "$ref": "#/components/schemas/StatusHistory"
            }
          },
          "staffInvolved": {
            "type": "array",
            "description": "Which members of staff were involved?",
            "items": {
              "$ref": "#/components/schemas/StaffInvolvement"
            }
          },
          "prisonersInvolved": {
            "type": "array",
            "description": "Which prisoners were involved?",
            "items": {
              "$ref": "#/components/schemas/PrisonerInvolvement"
            }
          },
          "locations": {
            "type": "array",
            "description": "Where the incident happened",
            "items": {
              "$ref": "#/components/schemas/Location"
            }
          },
          "evidence": {
            "type": "array",
            "description": "What evidence has been recorded",
            "items": {
              "$ref": "#/components/schemas/Evidence"
            }
          },
          "correctionRequests": {
            "type": "array",
            "description": "The corrections that were requested of this report",
            "items": {
              "$ref": "#/components/schemas/CorrectionRequest"
            }
          },
          "createdAt": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "When the report was first created",
            "example": "2021-07-05T10:35:17"
          },
          "modifiedAt": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "When the report was last changed",
            "example": "2021-07-05T10:35:17"
          },
          "modifiedBy": {
            "type": "string",
            "description": "Username of the person who last changed this report"
          },
          "createdInNomis": {
            "type": "boolean"
          }
        },
        "description": "Incident report"
      },
      "Response": {
        "required": [
          "recordedAt",
          "recordedBy",
          "response"
        ],
        "type": "object",
        "properties": {
          "response": {
            "type": "string",
            "description": "The response"
          },
          "recordedBy": {
            "type": "string",
            "description": "Username of person who responded to the question"
          },
          "recordedAt": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "When the response was made",
            "example": "2021-07-05T10:35:17"
          },
          "additionalInformation": {
            "type": "string",
            "description": "Optional additional information",
            "default": "null"
          }
        },
        "description": "Response to a question making up an incident report"
      },
      "StaffInvolvement": {
        "required": [
          "staffRole",
          "staffUsername"
        ],
        "type": "object",
        "properties": {
          "staffUsername": {
            "type": "string",
            "description": "Username"
          },
          "staffRole": {
            "type": "string",
            "description": "Their role",
            "enum": [
              "ACTIVELY_INVOLVED",
              "AUTHORISING_OFFICER",
              "CR_HEAD",
              "CR_LEFT_ARM",
              "CR_LEGS",
              "CR_RIGHT_ARM",
              "CR_SUPERVISOR",
              "DECEASED",
              "FIRST_ON_SCENE",
              "HEALTHCARE",
              "HOSTAGE",
              "IN_POSSESSION",
              "NEGOTIATOR",
              "PRESENT_AT_SCENE",
              "SUSPECTED_INVOLVEMENT",
              "VICTIM",
              "WITNESS"
            ]
          },
          "comment": {
            "type": "string",
            "description": "Optional comment on staff member involvement",
            "default": "null"
          }
        },
        "description": "Member of staff involved in an incident"
      },
      "StatusHistory": {
        "required": [
          "changedAt",
          "changedBy",
          "status"
        ],
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "description": "Previous current status of an incident report",
            "enum": [
              "DRAFT",
              "AWAITING_ANALYSIS",
              "IN_ANALYSIS",
              "INFORMATION_REQUIRED",
              "INFORMATION_AMENDED",
              "CLOSED",
              "POST_INCIDENT_UPDATE",
              "INCIDENT_UPDATED",
              "DUPLICATE"
            ]
          },
          "changedAt": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "When the report status was changed",
            "example": "2021-07-05T10:35:17"
          },
          "changedBy": {
            "type": "string",
            "description": "The member of staff who changed the report status"
          }
        },
        "description": "Previous statuses an incident report transitioned to"
      },
      "HmppsSubjectAccessRequestContent": {
        "required": [
          "content"
        ],
        "type": "object",
        "properties": {
          "content": {
            "type": "object",
            "description": "The content of the subject access request response"
          }
        }
      },
      "DlqMessage": {
        "required": [
          "body",
          "messageId"
        ],
        "type": "object",
        "properties": {
          "body": {
            "type": "object",
            "additionalProperties": {
              "type": "object"
            }
          },
          "messageId": {
            "type": "string"
          }
        }
      },
      "GetDlqResult": {
        "required": [
          "messages",
          "messagesFoundCount",
          "messagesReturnedCount"
        ],
        "type": "object",
        "properties": {
          "messagesFoundCount": {
            "type": "integer",
            "format": "int32"
          },
          "messagesReturnedCount": {
            "type": "integer",
            "format": "int32"
          },
          "messages": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/DlqMessage"
            }
          }
        }
      },
      "SimplePageReport": {
        "required": [
          "content",
          "number",
          "numberOfElements",
          "size",
          "sort",
          "totalElements",
          "totalPages"
        ],
        "type": "object",
        "properties": {
          "content": {
            "type": "array",
            "description": "Elements in this pages",
            "example": "[…]",
            "items": {
              "$ref": "#/components/schemas/Report"
            }
          },
          "number": {
            "type": "integer",
            "description": "Page number (0-based)",
            "format": "int32",
            "example": 0
          },
          "size": {
            "type": "integer",
            "description": "Page size",
            "format": "int32",
            "example": 20
          },
          "totalElements": {
            "type": "integer",
            "description": "Total number of elements in all pages",
            "format": "int64",
            "example": 55
          },
          "sort": {
            "type": "array",
            "description": "Sort orders",
            "example": [
              "property,ASC"
            ],
            "items": {
              "type": "string",
              "description": "Sort orders",
              "example": "[\"property,ASC\"]"
            }
          },
          "numberOfElements": {
            "type": "integer",
            "description": "Number of elements in this page",
            "format": "int32",
            "example": 20
          },
          "totalPages": {
            "type": "integer",
            "description": "Total number of pages",
            "format": "int32",
            "example": 3
          }
        }
      },
      "DeactivatableConstantDescription": {
        "required": [
          "code",
          "description"
        ],
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "description": "Machine-readable identifier of this value",
            "readOnly": true,
            "example": "DAMAGE"
          },
          "description": {
            "type": "string",
            "description": "Human-readable description of this value",
            "readOnly": true,
            "example": "Damage"
          },
          "active": {
            "type": "boolean",
            "description": "Whether this value is currently active and usable",
            "readOnly": true,
            "example": true,
            "default": true
          }
        },
        "description": "Code and description of a constant or enumeration member which may be active or inactive"
      },
      "ConstantDescription": {
        "required": [
          "code",
          "description"
        ],
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "description": "Machine-readable identifier of this value",
            "readOnly": true,
            "example": "VICTIM"
          },
          "description": {
            "type": "string",
            "description": "Human-readable description of this value",
            "readOnly": true,
            "example": "Victim"
          }
        },
        "description": "Code and description of a constant or enumeration member"
      }
    },
    "securitySchemes": {
      "bearer-jwt": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      },
      "hmpps-auth": {
        "type": "oauth2",
        "flows": {
          "clientCredentials": {
            "tokenUrl": "https://sign-in-dev.hmpps.service.justice.gov.uk/auth/oauth/token",
            "scopes": {
              "read": "Allows read of data",
              "write": "Allows write of data"
            }
          },
          "authorizationCode": {
            "authorizationUrl": "https://sign-in-dev.hmpps.service.justice.gov.uk/auth/oauth/authorize",
            "tokenUrl": "https://sign-in-dev.hmpps.service.justice.gov.uk/auth/oauth/token",
            "scopes": {
              "read": "Allows read of data",
              "write": "Allows write of data"
            }
          }
        }
      }
    }
  }
}
